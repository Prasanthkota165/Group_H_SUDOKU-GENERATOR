#include <stdio.h>
#include <math.h>
#include <stdlib.h>
#include <mcheck.h>
#define ROWS 9
#define COLS 9


/**
* Function apply_mask
* -------------------
* The function creats unique masks in turn creates a unique Sudoku game.
* Numbers are masked from the rearranged 2D array locations based on diffculty level. The difficulty levels are catagorized as easy, medium, hard,
* and very hard, where the easy game only shows 40 numbers, the medium 34 numbers, the hard game 28 and the very hard one only showing 24 numbers.
* The Sudoku game is made of 9x9 matrix with total of 81 cells. This algorithm generates numbers based on difficulty level between 1 to 81, where
* each radomly generated number representing a location at the 2D array locations, the randomly generated numbers are used to mask cell locations.
* Language C
* Author Gabriel Seyoum, Group H member
* Date May 31, 2020
*/


/**
* @param rearranged_sudoku [in], Array containing the rearranged Sudoku game.
* @param cells_to_remain [in], Number of cells that needed to be masked.
* @param masked_sudoku [out], Array containing the masked Sudoku game.
*/
void apply_mask(int rearranged_sudoku [ROWS][COLS], int diff_level, int masked_sudoku [ROWS][COLS])
{
     int total_num_cells = 81;                                    /* Number of cells in the Sudoku game */
     int max_track_dupplicate_size = 57;                          /* Maximum number of cells to be masked */           
     int l = 0, m = 0, random_cell;                               /* l and m ... index location of cells to be used for masking, random_cell variable holds random number generated between 1 to 81 */
     int random_cell_locations [total_num_cells];                 /* All the randomly selected cell locations to be used for masking */
     int cells_tobe_masked;
     int *ptr = random_cell_locations;
     int track_duplicate[max_track_dupplicate_size];
     int *track_duplicate_random_num = &track_duplicate [0];      /* To track no duplicate data is generated by random number generator, to be used for mapping Sudoku cell locations */                            

    
     switch(diff_level)
     {        
        case 0:  
            cells_tobe_masked = 41;    /* 41 locations will be masked */                              
            break;

        case 1:
            cells_tobe_masked = 47;    /* 47 locations will be masked */
            break;

        case 2:
            cells_tobe_masked = 53;    /* 53 locations will be masked */
            break;

        case 3:
            cells_tobe_masked = 57;    /* 57 locations will be masked */
            break;

        default:
            printf("Wrong difficulty level value\n");    /* Dificulty level is not 0, 1, 2 or 3 */
    }

    /* Initialization */
    for(int i = 0; i < ROWS; i++)
    {
        for(int j = 0; j < COLS; j++)
        {
            *(*(masked_sudoku + i) + j) = rearranged_sudoku [i][j];
        }
    }

    for(int i = 0; i < total_num_cells-1; i++)
        random_cell_locations[i] = 0;

    for(int i = 0; i < max_track_dupplicate_size; i++) 
        track_duplicate[i] = 0;

    /* Based on difficulty level cells are chosen radomly between 1 to 81, these values are then used to mask Sudoku game cell locations */
    for(int k = 0; k < cells_tobe_masked; k++)
    {
        random_cell = (rand() % (81 - 1 + 1)) + 1;

        *(track_duplicate_random_num + k) = random_cell;

        if(k == 0)
        {
            random_cell_locations[random_cell - 1] = random_cell;
        }

        /* The following code checks if duplicate random numbers are generated, if yes re-enforces no duplicate random numbers from being used to map cell locatio */
        for(int y = k  ; y >0 ; y--)
        {
            if(*(track_duplicate_random_num + k) == track_duplicate_random_num[y-1])
            {
               --k;
            }
            else
            {
                random_cell_locations[random_cell - 1] = random_cell;
            }
       }
    }
   
    /* Randomly chosen cell locations are mapped to the actual Sudoku game cell locations to mask some of the numbers based on the difficulty level */
    for(ptr = &random_cell_locations[0]; ptr <= &random_cell_locations[total_num_cells - 1]; ptr++)
    {
        if (*ptr != 0)
        {
             *(*(masked_sudoku + l) + m) = '\0';
        }

        m++;

        if(m == 9)
        {
            l++;
            m = 0;
        }
    }
}
